SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*and T101.T101F015_ORGANISATION_UNIT_NO = 802*/
ALTER VIEW [AUR].[sv_AURION_OrgStrucutre_Sel]
AS
SELECT CASE WHEN NEW_ORG_NO IS NULL THEN T101.T101F015_ORGANISATION_UNIT_NO ELSE NEW_ORG_NO END AS T106F005_ORGANISATION_UNIT_NO, CASE WHEN NEW_ORG_NO IS NULL 
             THEN T106.T106F030_ORGANISATION_UNIT ELSE SUP_ORG.T106F065_ORGANISATION_DESC END AS T106F030_ORGANISATION_UNIT, CASE WHEN SUP_ORG.T106F040_SUPERIOR_ORG_UNIT_NO IS NULL 
             THEN T106.T106F040_SUPERIOR_ORG_UNIT_NO ELSE SUP_ORG.T106F040_SUPERIOR_ORG_UNIT_NO END AS T106F040_SUPERIOR_ORG_UNIT_NO, CASE WHEN SUP_ORG.SUP_ORG_DESC IS NULL 
             THEN SUP_ORG.T106F065_ORGANISATION_DESC ELSE SUP_ORG.SUP_ORG_DESC END AS SUPERIOR_ORG_UNIT, T106.T106F055_LOCATION_CODE, T106.T106F065_ORGANISATION_DESC, T106.T106F070_ORG_UNIT_LEVEL_01, T106.T106F075_ORG_UNIT_LEVEL_02, 
             T106.T106F080_ORG_UNIT_LEVEL_03, T106.T106F085_ORG_UNIT_LEVEL_04, T106.T106F090_ORG_UNIT_LEVEL_05, T106.T106F095_ORG_UNIT_LEVEL_06, T106.T106F100_ORG_UNIT_LEVEL_07, T106.T106F105_ORG_UNIT_LEVEL_08, T106.T106F110_ORG_UNIT_LEVEL_09, 
             T106.T106F115_ORG_UNIT_LEVEL_10, T101.T101F005_POSITION_NO, T101.T101F045_POSITION_TITLE, T101.T101F130_REPORTS_TO_POSITION, T101.T101F010_POSITION_STATUS, T101.T101F235_ESS_AUTHORITY_LEVEL
FROM   AUR.T106_ORGANISATION_UNITS AS T106 INNER JOIN
             AUR.T101_POSITION AS T101 ON T101.T101F015_ORGANISATION_UNIT_NO = T106.T106F005_ORGANISATION_UNIT_NO INNER JOIN
             WD.EmpScope AS EMP ON EMP.OrgUnitID = T101.T101F015_ORGANISATION_UNIT_NO AND EMP.PositionID = T101.T101F005_POSITION_NO LEFT OUTER JOIN
             AUR.svAURION_NewOrgLevelManager_Sel AS ORG ON ORG.T101F005_POSITION_NO = T101.T101F005_POSITION_NO LEFT OUTER JOIN
             AUR.svARUION_OrgUnitRelationship_Sel AS SUP_ORG ON ORG.NEW_ORG_NO = SUP_ORG.T106F005_ORGANISATION_UNIT_NO
WHERE (T106.T106F010_ORG_UNIT_STATUS = 'active') AND (T101.T101F010_POSITION_STATUS = 'active') AND (T101.T101F235_ESS_AUTHORITY_LEVEL <> '1')
GO
